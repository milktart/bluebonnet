<!-- Travel Companion Access Partial -->
<div class="bg-white rounded-lg border border-gray-200 p-6">
  <div class="flex items-center mb-4">
    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
      <span class="material-symbols-outlined text-purple-600" style="font-size: 16px;">group</span>
    </div>
    <h3 class="text-lg font-bold text-gray-900">Travel Companion Access</h3>
  </div>
  <p class="text-sm text-gray-600 mb-4">
    Manage who has added you as a travel companion and can include you in their trips.
  </p>

  <% if (linkedCompanions && linkedCompanions.length > 0) { %>
    <div class="overflow-x-auto mb-6">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b-2 border-gray-200">
            <th class="text-left py-2 px-3 font-semibold text-gray-700">Added by</th>
            <th class="text-left py-2 px-3 font-semibold text-gray-700">Companion Name</th>
            <th class="text-left py-2 px-3 font-semibold text-gray-700">Email</th>
            <th class="text-left py-2 px-3 font-semibold text-gray-700">Added Date</th>
            <th class="text-left py-2 px-3 font-semibold text-gray-700">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% linkedCompanions.forEach(companion => { %>
            <tr class="border-b border-gray-100 hover:bg-gray-50">
              <td class="py-3 px-3">
                <div class="font-medium text-gray-900"><%= companion.creator.firstName %> <%= companion.creator.lastName %></div>
                <div class="text-xs text-gray-500"><%= companion.creator.email %></div>
              </td>
              <td class="py-3 px-3 text-gray-900"><%= companion.name %></td>
              <td class="py-3 px-3 text-gray-900"><%= companion.email %></td>
              <td class="py-3 px-3 text-gray-600">
                <span data-datetime="<%= companion.createdAt %>" data-format="date"></span>
              </td>
              <td class="py-3 px-3">
                <button type="button" class="px-3 py-1 text-sm bg-red-50 text-red-600 rounded-md hover:bg-red-100 border border-red-200"
                        onclick="revokeCompanionAccess('<%= companion.id %>', '<%= companion.creator.firstName %> <%= companion.creator.lastName %>')">
                  Revoke
                </button>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <div class="text-center py-8 bg-gray-50 rounded-lg mb-6">
      <span class="material-symbols-outlined text-gray-300 text-5xl block mb-3">group</span>
      <p class="font-medium text-gray-900 mb-2">No one has added you as a travel companion yet.</p>
      <p class="text-sm text-gray-600">
        When someone adds you as a companion using your email address, they'll appear here.
      </p>
    </div>
  <% } %>

  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <h4 class="font-semibold text-blue-900 mb-2 flex items-center">
      <span class="material-symbols-outlined text-blue-600 mr-2">info</span>
      About Travel Companion Access
    </h4>
    <ul class="text-sm text-blue-800 space-y-1 ml-4">
      <li class="list-disc">Users who have added you as a companion can include you in their trips</li>
      <li class="list-disc">You can see trips you've been added to and remove yourself from them</li>
      <li class="list-disc">Trip owners control whether you can edit trip details</li>
      <li class="list-disc">Revoking access prevents future trip additions but doesn't remove you from existing trips</li>
    </ul>
  </div>
</div>

<script>
  // Handle companion access revocation
  function revokeCompanionAccess(companionId, creatorName) {
    if (confirm(`Are you sure you want to revoke companion access from ${creatorName}? This will prevent them from adding you to future trips.`)) {
      fetch(`/account/companions/${companionId}/revoke`, {
        method: 'PUT'
      }).then(response => {
        if (response.ok) {
          location.reload();
        } else {
          alert('Failed to revoke companion access');
        }
      }).catch(error => {
        console.error('Error revoking companion access:', error);
        alert('Failed to revoke companion access');
      });
    }
  }
</script>
