<!-- Unified Car Rental Form - Used for both Add and Edit flows -->

<%
  const isAddMode = !isEditing;
  const modalId = isAddMode ? 'addCarRentalModal' : 'editCarRentalModal';
  const formId = isAddMode ? 'addCarRentalForm' : 'editCarRentalForm';
  const formAction = isAddMode
    ? `/car-rentals/trips/${tripId}/car-rentals`
    : `/car-rentals/${data?.id}`;
  const formMethod = isAddMode ? 'POST' : 'POST';
  const submitButtonText = isAddMode ? 'Add Car Rental' : 'Update Car Rental';
  const submitButtonIcon = isAddMode ? 'bi-plus-circle' : 'bi-check-circle';
%>

<div class="modal fade" id="<%= modalId %>" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi <%= isAddMode ? 'bi-car-front' : 'bi-pencil' %>"></i>
          <%= isAddMode ? 'Add Car Rental' : 'Edit Car Rental' %>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="<%= formId %>" method="<%= formMethod %>" action="<%= formAction %>">
        <% if (!isAddMode) { %>
          <input type="hidden" name="_method" value="PUT">
        <% } %>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Rental Company *</label>
            <input
              type="text"
              class="form-control"
              name="company"
              id="<%= isAddMode ? '' : 'edit_carRental_company' %>"
              value="<%= data?.company || '' %>"
              required
              placeholder="e.g., Hertz, Enterprise, Avis">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Pick-up Location *</label>
              <textarea
                class="form-control"
                name="pickupLocation"
                id="<%= isAddMode ? '' : 'edit_carRental_pickupLocation' %>"
                rows="2"
                required
                placeholder="Full pick-up address with city"><%= data?.pickupLocation || '' %></textarea>
              <small class="form-text text-muted">Be specific for accurate map placement</small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Pick-up Timezone</label>
              <input
                type="text"
                class="form-control"
                name="pickupTimezone"
                id="<%= isAddMode ? '' : 'edit_carRental_pickupTimezone' %>"
                value="<%= data?.pickupTimezone || '' %>"
                placeholder="e.g., America/New_York">
              <small class="form-text text-muted">For accurate local time</small>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Drop-off Location *</label>
              <textarea
                class="form-control"
                name="dropoffLocation"
                id="<%= isAddMode ? '' : 'edit_carRental_dropoffLocation' %>"
                rows="2"
                required
                placeholder="Full drop-off address with city"><%= data?.dropoffLocation || '' %></textarea>
              <small class="form-text text-muted">Can be different from pick-up</small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Drop-off Timezone</label>
              <input
                type="text"
                class="form-control"
                name="dropoffTimezone"
                id="<%= isAddMode ? '' : 'edit_carRental_dropoffTimezone' %>"
                value="<%= data?.dropoffTimezone || '' %>"
                placeholder="e.g., America/Los_Angeles">
              <small class="form-text text-muted">For accurate local time</small>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Pick-up Date/Time *</label>
              <div class="row">
                <div class="col-7">
                  <input
                    type="date"
                    class="form-control"
                    name="pickupDate"
                    id="<%= isAddMode ? '' : 'edit_carRental_pickupDate' %>"
                    value="<%= data?.pickupDate || '' %>"
                    required>
                </div>
                <div class="col-5">
                  <input
                    type="time"
                    class="form-control"
                    name="pickupTime"
                    id="<%= isAddMode ? '' : 'edit_carRental_pickupTime' %>"
                    value="<%= data?.pickupTime || '' %>"
                    required>
                </div>
              </div>
              <small class="form-text text-muted">Local pick-up time</small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Drop-off Date/Time *</label>
              <div class="row">
                <div class="col-7">
                  <input
                    type="date"
                    class="form-control"
                    name="dropoffDate"
                    id="<%= isAddMode ? '' : 'edit_carRental_dropoffDate' %>"
                    value="<%= data?.dropoffDate || '' %>"
                    required>
                </div>
                <div class="col-5">
                  <input
                    type="time"
                    class="form-control"
                    name="dropoffTime"
                    id="<%= isAddMode ? '' : 'edit_carRental_dropoffTime' %>"
                    value="<%= data?.dropoffTime || '' %>"
                    required>
                </div>
              </div>
              <small class="form-text text-muted">Local drop-off time</small>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Confirmation Number</label>
            <input
              type="text"
              class="form-control"
              name="confirmationNumber"
              id="<%= isAddMode ? '' : 'edit_carRental_confirmationNumber' %>"
              value="<%= data?.confirmationNumber || '' %>"
              placeholder="Reservation confirmation number">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="bi <%= submitButtonIcon %>"></i> <%= submitButtonText %>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
