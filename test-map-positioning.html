<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Map Positioning</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Tailwind CSS -->
  <link href="https://unpkg.com/tailwindcss@^2.0/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Full height map with no padding/margins */
    #tripMap {
      height: 100vh;
      width: 100vw;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 0;
    }

    /* Main Sidebar overlay - floating over map */
    .main-sidebar {
      position: fixed;
      top: 3vh;
      left: 3vh;
      height: calc(100vh - 6vh);
      width: 400px;
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      overflow: hidden;
      border-radius: 12px;
      border: 1px solid #e4e4e7;
      display: flex;
      flex-direction: column;
    }

    /* Mobile bottom sheet */
    @media (max-width: 768px) {
      .main-sidebar {
        top: auto;
        bottom: 3vh;
        left: 3vh;
        right: 3vh;
        width: calc(100% - 6vh);
        height: 50vh;
        border-radius: 16px;
      }
    }
  </style>
</head>
<body class="overflow-hidden">
  <!-- Full-screen map -->
  <div id="tripMap"></div>

  <!-- Main Sidebar overlay -->
  <div class="main-sidebar">
    <div class="p-6">
      <h1 class="text-xl font-bold text-gray-900">Test Trip</h1>
      <p class="text-sm text-gray-500">Testing map positioning</p>
      <div class="mt-4 space-y-2">
        <div class="p-3 bg-blue-50 border border-blue-200 rounded-md">
          <div class="flex items-center">
            <div class="w-5 h-5 bg-blue-600 rounded-full mr-3 flex items-center justify-content center text-white font-bold text-xs">1</div>
            <span class="text-sm">NYC → LAX</span>
          </div>
        </div>
        <div class="p-3 bg-green-50 border border-green-200 rounded-md">
          <div class="flex items-center">
            <div class="w-5 h-5 bg-green-600 rounded-full mr-3"></div>
            <span class="text-sm">Hotel California</span>
          </div>
        </div>
        <div class="p-3 bg-amber-50 border border-amber-200 rounded-md">
          <div class="flex items-center">
            <div class="w-5 h-5 bg-amber-600 rounded-full mr-3 flex items-center justify-center text-white font-bold text-xs">2</div>
            <span class="text-sm">LAX → SFO</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="public/js/map.js"></script>

  <script>
    // Sample trip data for testing
    const testTripData = {
      flights: [
        {
          id: '1',
          airline: 'American Airlines',
          flightNumber: 'AA123',
          origin: 'JFK - New York, NY',
          destination: 'LAX - Los Angeles, CA',
          originLat: 40.6413,
          originLng: -73.7781,
          destinationLat: 33.9425,
          destinationLng: -118.4081,
          departureDateTime: '2024-10-20T10:00:00Z',
          arrivalDateTime: '2024-10-20T13:30:00Z'
        },
        {
          id: '2',
          airline: 'United',
          flightNumber: 'UA456',
          origin: 'LAX - Los Angeles, CA',
          destination: 'SFO - San Francisco, CA',
          originLat: 33.9425,
          originLng: -118.4081,
          destinationLat: 37.6213,
          destinationLng: -122.3790,
          departureDateTime: '2024-10-22T14:00:00Z',
          arrivalDateTime: '2024-10-22T15:30:00Z'
        }
      ],
      hotels: [
        {
          id: '1',
          hotelName: 'Hotel California',
          address: 'Beverly Hills, CA',
          lat: 34.0669,
          lng: -118.4012,
          checkInDateTime: '2024-10-20T15:00:00Z',
          checkOutDateTime: '2024-10-22T12:00:00Z'
        }
      ],
      transportation: [],
      carRentals: [],
      events: []
    };

    // Initialize map when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Initializing test map...');

      setTimeout(() => {
        if (typeof initializeMap !== 'undefined') {
          const mapEl = document.getElementById('tripMap');
          mapEl.id = 'map';

          initializeMap(testTripData)
            .then((map) => {
              console.log('Test map initialized successfully');

              // Just ensure map size is properly calculated after initialization
              setTimeout(() => {
                if (map && typeof map.invalidateSize === 'function') {
                  map.invalidateSize(true);
                }
              }, 100);
            })
            .catch(error => {
              console.error('Test map initialization error:', error);
              const mapEl = document.getElementById('map');
              if (mapEl) {
                mapEl.innerHTML = '<div class="bg-red-50 border border-red-200 rounded-md p-4 text-red-700">Map failed to load: ' + error.message + '</div>';
              }
            });
        } else {
          console.error('initializeMap function not found');
          const mapEl = document.getElementById('tripMap');
          mapEl.innerHTML = '<div class="bg-red-50 border border-red-200 rounded-md p-4 text-red-700">Map library not loaded. Check that public/js/map.js is accessible.</div>';
        }
      }, 500);
    });
  </script>
</body>
</html>